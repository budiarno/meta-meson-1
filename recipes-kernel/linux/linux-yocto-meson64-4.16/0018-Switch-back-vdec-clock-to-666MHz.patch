From 2aa05dd29cab75208f79d4976e7fa585dd498562 Mon Sep 17 00:00:00 2001
From: Neil Armstrong <narmstrong@baylibre.com>
Date: Tue, 3 Apr 2018 12:01:20 +0200
Subject: [PATCH] Switch back vdec clock to 666MHz

---
 arch/arm64/boot/dts/amlogic/meson-gxl.dtsi | 8 ++++++--
 drivers/media/platform/meson/vdec/h264.c   | 4 ++--
 2 files changed, 8 insertions(+), 4 deletions(-)

diff --git a/arch/arm64/boot/dts/amlogic/meson-gxl.dtsi b/arch/arm64/boot/dts/amlogic/meson-gxl.dtsi
index 99dc439..87bf554 100644
--- a/arch/arm64/boot/dts/amlogic/meson-gxl.dtsi
+++ b/arch/arm64/boot/dts/amlogic/meson-gxl.dtsi
@@ -851,6 +851,10 @@
 	clocks = <&clkc CLKID_VPU_INTR>, <&clkc CLKID_DOS_PARSER>, <&clkc CLKID_VDEC_1>;
 	clock-names = "vpu_intr", "dos_parser", "vdec_1";
 
-	assigned-clocks = <&clkc CLKID_VDEC_1>;
-	assigned-clock-rates = <648000000>;
+	assigned-clocks = <&clkc CLKID_VDEC_1_SEL>,
+			  <&clkc CLKID_VDEC_1>;
+	assigned-clock-parents = <&clkc CLKID_FCLK_DIV3>,
+				 <0>;
+	assigned-clock-rates = <0>,
+			       <666666666>;
 };
diff --git a/drivers/media/platform/meson/vdec/h264.c b/drivers/media/platform/meson/vdec/h264.c
index 060db55..8fa0072 100644
--- a/drivers/media/platform/meson/vdec/h264.c
+++ b/drivers/media/platform/meson/vdec/h264.c
@@ -99,7 +99,7 @@ static int vdec_h264_buffers_thread(void *data)
 			if (!(vbuf->sequence % 100))
 				printk("%d\n", vbuf->sequence);
 				
-			printk("Buffer %d done\n", tmp->index);
+			//printk("Buffer %d done\n", tmp->index);
 
 			v4l2_m2m_buf_done(vbuf, VB2_BUF_STATE_DONE);
 
@@ -124,7 +124,7 @@ static int vdec_h264_buffers_thread(void *data)
 			else
 				writel_relaxed(tmp->index + 1, core->dos_base + AV_SCRATCH_8);
 				
-			printk("Buffer %d recycled\n", tmp->index);
+			//printk("Buffer %d recycled\n", tmp->index);
 
 			list_del(&tmp->list);
 			kfree(tmp);
